-- Crear la tabla de grupos
CREATE TABLE grupos (
    nombre_grupo VARCHAR(20) NOT NULL,
    descripcion VARCHAR(200) NOT NULL,
    PRIMARY KEY (nombre_grupo)
);

-- Crear la tabla de usuarios
CREATE TABLE usuarios (
    id_usuario INT NOT NULL AUTO_INCREMENT,
    nombre_usuario VARCHAR(50) NOT NULL,
    `password` VARCHAR(50) NOT NULL,
    email VARCHAR(100),
    rol VARCHAR(20) NOT NULL,
    PRIMARY KEY (id_usuario),
    FOREIGN KEY (rol) REFERENCES grupos(nombre_grupo)
);

-- Crear la tabla de bibliotecas
CREATE TABLE bibliotecas (
    id_biblioteca INT NOT NULL AUTO_INCREMENT,
    nombre_biblioteca VARCHAR(50) NOT NULL,
    direccion VARCHAR(100),
    PRIMARY KEY (id_biblioteca)
);

-- Crear la tabla de documentos
CREATE TABLE documentos (
    id_documento INT NOT NULL AUTO_INCREMENT,
    isbn INT NOT NULL,
    tipo_documento VARCHAR(20) NOT NULL,
    nombre VARCHAR(50) NOT NULL,
    descripcion VARCHAR(200),
    autor VARCHAR(50) NOT NULL,
    editorial_productora VARCHAR(50),
    npaginas_duracion INT NOT NULL,
    formato VARCHAR(10),
    fecha_publicacion DATE NOT NULL,
    id_biblioteca INT NOT NULL,
    PRIMARY KEY (id_documento),
    FOREIGN KEY (id_biblioteca) REFERENCES bibliotecas(id_biblioteca)
);

-- Crear tabla de replicas
CREATE TABLE repilicas (
    id_documento INT NOT NULL AUTO_INCREMENT,
    numero_repilcas INT NOT NULL,
    PRIMARY KEY (id_documento),
    FOREIGN KEY (id_documento) REFERENCES documentos(id_biblioteca)
);

-- Crear la tabla de categorías
CREATE TABLE categorias (
    id_categoria INT NOT NULL AUTO_INCREMENT,
    nombre_categoria VARCHAR(50) NOT NULL,
    descripcion VARCHAR(200),
    PRIMARY KEY (id_categoria)
);

-- Crear la tabla de documentos por categoría
CREATE TABLE documentos_por_categoria (
    id_documento INT NOT NULL,
    id_categoria INT NOT NULL,
    PRIMARY KEY (id_documento, id_categoria),
    FOREIGN KEY (id_documento) REFERENCES documentos(id_documento),
    FOREIGN KEY (id_categoria) REFERENCES categorias(id_categoria)
);

-- Crear la tabla de préstamos
CREATE TABLE prestamos (
    id_prestamo INT NOT NULL AUTO_INCREMENT,
    id_usuario INT NOT NULL,
    id_documento INT NOT NULL,
    fecha_prestamo DATE NOT NULL,
    fecha_devolucion DATE NOT NULL,
    dias_retardo INT,
    PRIMARY KEY (id_prestamo),
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario),
    FOREIGN KEY (id_documento) REFERENCES documentos(id_documento)
);

-- Crear la tabla de reservas
CREATE TABLE reservas (
    id_reserva INT NOT NULL AUTO_INCREMENT,
    id_usuario INT NOT NULL,
    id_documento INT NOT NULL,
    fecha_reserva DATE NOT NULL,
    dias_pendientes INT NOT NULL,
    PRIMARY KEY (id_reserva),
    FOREIGN KEY (id_usuario) REFERENCES usuarios(id_usuario),
    FOREIGN KEY (id_documento) REFERENCES documentos(id_documento)
);

-- Crear la tabla de autores
CREATE TABLE autores (
    id_autor INT NOT NULL AUTO_INCREMENT,
    nombre_autor VARCHAR(50) NOT NULL,
    PRIMARY KEY (id_autor)
);

-- Crear la tabla de documentos por autor
CREATE TABLE documentos_por_autor (
    id_documento INT NOT NULL,
    id_autor INT NOT NULL,
    PRIMARY KEY (id_documento, id_autor),
    FOREIGN KEY (id_documento) REFERENCES documentos(id_documento),
    FOREIGN KEY (id_autor) REFERENCES autores(id_autor)
);